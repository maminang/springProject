<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.mapper.board">
	<sql id="searchIf">
		<if test="searchType != null">
			<if test="searchType == 'title'.toString()">
				where upper(title) like '%'||upper(#{keyword})||'%'</if>
			<if test="searchType == 'writer'.toString()">
				where lower(writer) like '%'||lower(#{keyword})||'%'</if>
			<if test="searchType == 'content'.toString()">
				where lower(content) like '%'||lower(#{keyword})||'%'
			</if>
		</if>
	</sql>

	<select id="list" resultType="kr.co.domain.BoardVO">
		select * from tbl_board order by
		bno desc
	</select>
	<select id="selectByBno" resultType="kr.co.domain.BoardVO">
		select * from tbl_board
		where bno = #{bno}
	</select>
	<insert id="insert">
		insert into
		tbl_board(bno,title,writer,content,viewcnt) values (#{bno}, #{title},
		#{writer}, #{content}, 0)
	</insert>
	<select id="crtBno" resultType="Integer">
		select max(bno) from tbl_board
	</select>
	<update id="update">
		update tbl_board set title=#{title}, writer =
		#{writer}, content=#{content}, updatedate=sysdate where bno = #{bno}
	</update>
	<delete id="delete">
		delete tbl_board where bno = #{bno}
	</delete>
	<select id="amount" resultType="Integer">
		select count(bno) from tbl_board
	</select>
	<select id="search" resultType="kr.co.domain.BoardVO">
	 	<![CDATA[
			select * from tbl_board
		]]>
		<include refid="searchIf" />
		<![CDATA[
			order by bno desc
		]]>
	</select>

	<select id="getSearchAmount" resultType="Integer">
		select count(bno) from tbl_board
		<include refid="searchIf" />
	</select>

	<update id="incrViewCnt">
		update tbl_board set viewcnt = viewcnt + 1 where bno
		= #{bno}
	</update>

	<select id="getId" resultType="Integer">
		select max(id) from tbl_attach
	</select>

	<insert id="addAttach">
		insert into tbl_attach (id,fullname,bno) values
		(#{id},#{fullName},#{bno})
	</insert>

	<delete id="deleteAllAttach">
		delete tbl_attach where bno = #{bno}
	</delete>

	<delete id="deleteAttach">
		delete tbl_attach where bno = #{bno} and
		fullname=#{fileName}
	</delete>
</mapper>